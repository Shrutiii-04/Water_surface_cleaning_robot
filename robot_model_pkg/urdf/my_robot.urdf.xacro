<?xml version="1.0"?>
<robot name="water_cleaner_bot" xmlns:xacro="http://ros.org/wiki/xacro">

  <!-- COLORS -->
  <material name="Blue"><color rgba="0 0 1 1"/></material>
  <material name="Black"><color rgba="0 0 0 1"/></material>
  <material name="Grey"><color rgba="0.5 0.5 0.5 1"/></material>

  <!-- Dummy root to avoid KDL inertia issue -->
  <link name="base_link"/>
  <joint name="base_joint" type="fixed">
    <parent link="base_link"/>
    <child link="body_link"/>
    <origin xyz="0 0 0.05" rpy="0 0 0"/>
  </joint>

  <!-- Main body -->
  <link name="body_link">
    <visual>
      <geometry><box size="0.6 0.4 0.2"/></geometry>
      <material name="Blue"/>
    </visual>
    <collision><geometry><box size="0.6 0.4 0.2"/></geometry></collision>
    <inertial>
      <mass value="12"/>
      <inertia ixx="0.2" ixy="0" ixz="0" iyy="0.2" iyz="0" izz="0.2"/>
    </inertial>
  </link>

  <!-- Visual wheels -->
  <link name="wheel_left_link"><visual><geometry><cylinder radius="0.06" length="0.03"/></geometry><material name="Black"/></visual></link>
  <joint name="wheel_left_joint" type="continuous">
    <parent link="body_link"/><child link="wheel_left_link"/>
    <origin xyz="0 0.22 -0.06" rpy="0 1.5708 0"/><axis xyz="0 0 1"/>
  </joint>

  <link name="wheel_right_link"><visual><geometry><cylinder radius="0.06" length="0.03"/></geometry><material name="Black"/></visual></link>
  <joint name="wheel_right_joint" type="continuous">
    <parent link="body_link"/><child link="wheel_right_link"/>
    <origin xyz="0 -0.22 -0.06" rpy="0 1.5708 0"/><axis xyz="0 0 1"/>
  </joint>

  <!-- 2D LIDAR -->
  <link name="lidar_link"><visual><geometry><cylinder radius="0.04" length="0.05"/></geometry><material name="Grey"/></visual></link>
  <joint name="lidar_joint" type="fixed">
    <parent link="body_link"/><child link="lidar_link"/>
    <origin xyz="0 0 0.15" rpy="0 0 0"/>
  </joint>

  <!-- Attach GZ sensor properly -->
  <gazebo reference="lidar_link">
    <sensor name="lidar_sensor" type="gpu_laser">
      <always_on>true</always_on>
      <visualize>true</visualize>
      <update_rate>10</update_rate>

      <ray>
        <scan>
          <horizontal>
            <samples>360</samples>
            <min_angle>-3.14159</min_angle>
            <max_angle>3.14159</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.1</min>
          <max>20.0</max>
        </range>
      </ray>

      <!-- Correct Harmonic Laser Plugin -->
      <plugin name="gz_ros2_lidar" filename="libgazebo_ros2_gpu_laser.so">
        <ros2>
          <namespace>/</namespace>
          <remapping>~/out:=/scan</remapping>
        </ros2>
        <frame_name>lidar_link</frame_name>
      </plugin>
    </sensor>
  </gazebo>

</robot>
